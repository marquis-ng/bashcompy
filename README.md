# bashcompy
A simple Bash completion script generator, written in Python.

## Introduction
`bashcompy` can shorten the process of creating a completion script by creating a `.yaml` file only.

## Why is it called "bashcompy"?
Split "bashcompy" into "bash", "comp", "py". It means "Bash completion (written in) Python".

## Installation
Copy this and paste it in your terminal:
```bash
wget https://raw.githubusercontent.com/marquis-ng/bashcompy/main/bashcompy.py
# curl https://raw.githubusercontent.com/marquis-ng/bashcompy/main/bashcompy.py -o bashcompy.py
```
Done!

## Documentation
### Usage
```
# python3 bashcompy.py [input file] [[output file]]
python3 bashcompy.py abc.yaml # print completion script to stdout
python3 bashcompy.py abc.yaml abc.bash # write completion script to file
```

### Example
Suppose we have `program` with subcommand `foo`, `bar` and `baz`:
```
program
├── foo
│   ├── string
│   ├── string2
│   └── morestrings
├── bar
│   └── $(ls /SOMEDIR)
└── baz
    ├── --arg1 [file]
    └── --arg2
```

We add the following to `completion.yaml`:
```yaml
program:
- foo
- bar
- baz

program foo:
- <directory>

program bar:
- $(ls /SOMEDIR)

program baz:
- --arg1
- --arg2

program baz*--arg1:
- hello
- world
```

### Explanation
#### Static completion:
```yaml
program:
- foo
- bar
- baz
```

#### Actions:
See section "-A action" part [here](https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion-Builtins.html) for list of actions. Any action can be completed using the `<action>` syntax.
```yaml
program foo:
- <directory>
```
This makes the autocomplete suggest directories.

#### Dynamic completion:
```yaml
program bar:
- $(ls /SOMEDIR)
```
**Note: the output of command should white-space delimited.**

#### Argument completion:
```yaml
program baz*--arg1:
- hello
- world
```
This makes autocomplete suggest "hello" and "world" if the last argument is "--arg1".

### Generating the completion script
Run the Python file:
```bash
# python3 bashcompy.py [yaml file]
python3 bashcompy.py abc.yaml
```

### Exit codes
| Code | Meaning |
| :-- | :-- |
| `0` | No errors |
| `1` | Invalid arguments supplied |
| `2` | Input file does not exist |
| `3` | Output file is a directory |
| `4` | `ImportError` and module failed to install |

## Extras
### Editing the generated script manually
The code generated by `bashcompy` is only a template. You may edit the generated script if you know what you are doing.

### Wrapper for `bashcompy`
Normally, we need to write the generated completion script to a file and source it. Repeating this process a million times is very tedious. This function can help:
```bash
previewcomp() { . <(python3 bashcompy.py "$@"); }
```

Using the function:
```bash
previewcomp abc.yaml
```

The completion should be updated with this simple command.
